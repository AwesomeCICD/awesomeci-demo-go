version: v1.0
name: awesomeci-demo-go
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
  containers:
    - name: main
      image: 'semaphoreci/golang:1.12.9'
    - name: db
      image: 'postgres:9.6'
      env_vars:
        - name: POSTGRES_PASSOWRD
          value: keyboard-cat
blocks:
  - name: Build
    task:
      jobs:
        - name: Build Block
          commands:
            - checkout
            - mkdir -p $TEST_RESULTS
            - cache-restore go-mod-v4-$(checksum go.sum)
      env_vars:
        - name: TEST_RESULTS
          value: /tmp/test-results
